---

- name: "Install epel-release"
  yum:
    pkg:        "{{ item }}"
    state:      "present"
  with_items:
    - epel-release

- name: "Install python-pip and compilation dependencies"
  yum:
    pkg:        "{{ item }}"
    state:      "present"
  with_items:
    - python-pip
    - python-devel
    - gcc

- name: "Update pip with pip"
  pip:
    name: pip
    state: latest

- name: "Install Ansible Runbook Analysis"
  pip:
    name: ara
    state: present

- name: "Create /var/lib/ara directory"
  file:
    name:  "{{ item.name }}"
    state: "directory"
    owner: "{{ item.owner | default('root')}}"
    group: "{{ item.group | default('root') }}"
    mode:  "{{ item.mode | default('0755') }}"
  with_items:
    - name: "/var/lib/ara"
    - name:  "/var/lib/ara/.ara"
      group: "wheel"
      mode:  "0775"
  run_once: true

- name: "Create /var/lib/ara/.ara/ files"
  file:
    name:  "{{ item.name }}"
    state: "touch"
    owner: "{{ item.owner | default('root')}}"
    group: "{{ item.group | default('root') }}"
    mode:  "{{ item.mode | default('0644') }}"
  with_items:
    - name:  "/var/lib/ara/.ara/ansible.sqlite"
      group: "wheel"
      mode:  "0664"
    - name:  "/var/lib/ara/.ara/ara.log"
      group: "wheel"
      mode:  "0664"
  run_once: true